"use strict";angular.module("voluntrApp",["ngAnimate","ngCookies","daterangepicker","ngResource","ngRoute","ngSanitize","ngTouch","facebook","ui.bootstrap","pc035860.scrollWatch","ui.router","duScroll","ngMaterial","ngFileUpload","pdf","ngMap","Devise","geolocation","highcharts-ng","ng-mfb","mdDateTime","config","angular-duration-format","ui.calendar","snap","leaflet-directive","kendo.directives","ngHandsontable","angulartics","angulartics.google.analytics","ngIdle","ngCsv","md.data.table"]).config(["IdleProvider","KeepaliveProvider",function(a,b){a.idle(4),a.timeout(6),b.interval(10)}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("blue").accentPalette("pink").warnPalette("red")}]).config(["FacebookProvider","ENV",function(a,b){a.init(b.appId)}]).config(["$httpProvider","AuthProvider",function(a,b){b.registerPath("/api/v1/users.json"),b.loginPath("/api/v1/users/sign_in.json"),a.interceptors.push("authInterceptor")}]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c,a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.previousState_name=e.name,a.previousState_params=f,console.log(a.previousState_name)}),a.back=function(){b.go(a.previousState_name,a.previousState_params)}}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("landing_page",{url:"/",templateUrl:"static_pages/landing_page.html",controller:"LandingPageCtrl"}).state("volunteer_home",{url:"/volunteer_home",templateUrl:"volunteers/volunteer_home.html",controller:"VolunteerHomeCtrl"}).state("organizations",{url:"/organizations","abstract":!0,templateUrl:"organizations/organization.html",controller:"OrganizationMainCtrl"}).state("organizations.registration",{url:"/registration",templateUrl:"organizations/registration/organization_registration.html",controller:"OrganizationRegistrationCtrl"}).state("organizations.tutorial",{url:"/:organization_Id/tutorial",templateUrl:"organizations/tutorial/tutorial.html",controller:"OrganizationTutorialCtrl"}).state("organizations.tutorial.1",{url:"/1",templateUrl:"organizations/tutorial/tutorial_screen_1.html",controller:"OrganizationTutorialCtrl"}).state("organizations.tutorial.2",{url:"/2",templateUrl:"organizations/tutorial/tutorial_screen_2.html",controller:"OrganizationTutorialCtrl"}).state("organizations.tutorial.3",{url:"/3",templateUrl:"organizations/tutorial/tutorial_screen_3.html",controller:"OrganizationTutorialCtrl"}).state("organizations.tutorial.4",{url:"/4",templateUrl:"organizations/tutorial/tutorial_screen_4.html",controller:"OrganizationTutorialCtrl"}).state("organizations.tutorial.5",{url:"/5",templateUrl:"organizations/tutorial/tutorial_screen_5.html",controller:"OrganizationTutorialCtrl"}).state("organizations.tutorial.6",{url:"/6",templateUrl:"organizations/tutorial/tutorial_screen_6.html",controller:"OrganizationTutorialCtrl"}).state("organizations.organization_home",{url:"/:organization_Id",templateUrl:"organizations/home/organization_home.html",controller:"OrganizationHomeCtrl"}).state("organizations.organization_account",{url:"/:organization_Id/account",templateUrl:"organizations/account/organization_account.html",controller:"OrganizationAccountCtrl"}).state("organizations.people_home",{url:"/:organization_Id/people_home",templateUrl:"organizations/people/people_home.html",controller:"PeopleHomeCtrl"}).state("organizations.groups_home",{url:"/:organization_Id/groups_home",templateUrl:"organizations/groups/groups_home.html",controller:"GroupsHomeCtrl"}).state("organizations.opportunities_home",{url:"/:organization_Id/opportunity_home",templateUrl:"organizations/opportunities/opportunities_home.html",controller:"OpportunitiesHomeCtrl"}).state("organization_volunteer_registration",{"abstract":!0,url:"/:organization_custom_Url/registration",templateUrl:"organizations/volunteer_registration/volunteer_registration.html",controller:"OrganizationVolunteerRegistrationCtrl"}).state("organization_volunteer_registration.1",{url:"?token",templateUrl:"organizations/volunteer_registration/volunteer_registration_1.html"}).state("organization_volunteer_registration.2",{url:"/2?token",templateUrl:"organizations/volunteer_registration/volunteer_registration_2.html"}).state("organization_volunteer_registration.3",{url:"/3?token",templateUrl:"organizations/volunteer_registration/volunteer_registration_3.html"}).state("organization_volunteer_registration.4",{url:"/4?token",templateUrl:"organizations/volunteer_registration/volunteer_registration_4.html"}).state("registration_form",{url:"/:opportunity_Id/opportunity_registration",templateUrl:"organizations/opportunities/registration_form.html",controller:"OpportunityRegistrationCtrl"}).state("sign_in_form",{url:"/:opportunity_Id/sign_in",templateUrl:"organizations/opportunities/sign_in_form.html",controller:"OpportunitySignInCtrl"}).state("profile",{url:"/profile/:profile_Id",templateUrl:"views/profile.html",controller:"ProfileCtrl"})}]),function(a){if("undefined"==typeof XLSX)return void console.log("xlsx.js is required. Get it from https://github.com/SheetJS/js-xlsx");if("undefined"==typeof _)return void console.log("Lodash.js is required. Get it from http://lodash.com/");var b=this,c=(b.XLSXReader,function(a,b,d,e){var f={};return c.utils.intializeFromFile(f,a,b,d,e),f});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.XLSXReader=c):b.XLSXReader=c,c.VERSION="0.0.1",c.utils={intializeFromFile:function(a,b,d,e,f){var g=new FileReader;g.onload=function(b){var g=b.target.result,h=XLSX.read(g,{type:"binary"});a.sheets=c.utils.parseWorkbook(h,d,e),f(a)},g.readAsBinaryString(b)},parseWorkbook:function(a,b,d){if(d===!0)return c.utils.to_json(a);var e={};return _.forEachRight(a.SheetNames,function(d){var f=a.Sheets[d];e[d]=c.utils.parseSheet(f,b)}),e},parseSheet:function(b,c){var d=XLSX.utils.decode_range(b["!ref"]),e=[];return c===!0&&_.forEachRight(_.range(d.s.r,d.e.r+1),function(c){var f=[];_.forEachRight(_.range(d.s.c,d.e.c+1),function(d){var e=XLSX.utils.encode_cell({c:d,r:c}),g=b[e];f[d]=g?g.v:a}),e[c]=f}),{data:e,name:b.name,col_size:d.e.c+1,row_size:d.e.r+1}},to_json:function(a){var b={};return a.SheetNames.forEach(function(c){var d=XLSX.utils.sheet_to_row_object_array(a.Sheets[c]);d.length>0&&(b[c]=d)}),b}}}.call(this);var app=angular.module("voluntrApp");app.factory("XLSXReaderService",["$q","$rootScope",function(a,b){var c=function(a){angular.extend(this,a)};return c.readFile=function(c,d,e){var f=a.defer();return XLSXReader(c,d,e,function(a){b.$apply(function(){f.resolve(a)})}),f.promise},c}]),angular.module("voluntrApp").factory("Organization",["$resource",function(a){function b(){this.service=a("/api/v1/organizations/:organization_Id",{organization_Id:"@id"},{existence_check:{method:"GET",url:"/api/v1/organizations/existence_check/:fb_id"},organization_object:{method:"GET",url:"/api/v1/organizations/:organization_Id/:object",isArray:!0},organization_filtered_object:{method:"GET",url:"/api/v1/organizations/:organization_Id/:object",isArray:!0},authorization:{method:"GET",url:"/api/v1/organizations/:organization_Id/authorization"},get_by_url:{method:"GET",url:"/api/v1/organizations/by_url/:organization_custom_Url"},update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({organization_Id:a})},b.prototype.existence_check=function(a){return this.service.existence_check({fb_id:a})},b.prototype.recorded_hours=function(a,b){return this.service.organization_object({organization_Id:a,object:b})},b.prototype.daily_statistics=function(a,b){return this.service.organization_object({organization_Id:a,object:b})},b.prototype.opportunities=function(a,b){return this.service.organization_object({organization_Id:a,object:b})},b.prototype.contact_volunteers=function(a,b){return this.service.organization_object({organization_Id:a,object:b})},b.prototype.mail_chimp_check=function(a,b){return this.service.organization_object({organization_Id:a,object:b})},b.prototype.people=function(a,b,c){return this.service.organization_filtered_object({organization_Id:a,object:b,query:c})},b.prototype.posts=function(a,b){return this.service.organization_object({organization_Id:a,object:b})},b.prototype.get_by_url=function(a,b,c){return this.service.get_by_url(a,b,c)},b.prototype.authorization=function(a,b){return this.service.authorization({organization_Id:b,oauth:a})},new b}]),angular.module("voluntrApp").factory("Opportunity",["$resource",function(a){function b(){this.service=a("/api/v1/opportunities/:opportunity_Id",{opportunity_Id:"@id"},{update:{method:"PATCH"},opportunity_object:{method:"GET",url:"/api/v1/opportunities/:opportunity_Id/:object",isArray:!0}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.instance_statistics=function(a,b){return this.service.opportunity_object({opportunity_Id:a,object:b})},b.prototype.volunteers=function(a,b){return this.service.opportunity_object({opportunity_Id:a,object:b})},b.prototype.recorded_hours=function(a,b){return this.service.opportunity_object({opportunity_Id:a,object:b})},b.prototype.roles=function(a,b){return this.service.opportunity_object({opportunity_Id:a,object:b})},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({opportunity_Id:a})},new b}]),angular.module("voluntrApp").factory("GroupAdministrator",["$resource",function(a){function b(){this.service=a("/api/v1/group_administrators/:group_administrator_Id",{group_administrator_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.all=function(){return this.service.query()},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},new b}]),angular.module("voluntrApp").factory("OpportunityRole",["$resource",function(a){function b(){this.service=a("/api/v1/opportunity_roles/:opportunity_role_Id",{opportunity_role_Id:"@id"},{update:{method:"PATCH"},OpportunityRole_object:{method:"GET",url:"/api/v1/opportunities/:opportunity_role_Id/:object",isArray:!0}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({opportunity_role_Id:a})},new b}]),angular.module("voluntrApp").factory("PersonOpportunity",["$resource",function(a){function b(){this.service=a("/api/v1/person_opportunities/:person_opportunity_Id",{organization_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({person_opportunity_Id:a})},new b}]),angular.module("voluntrApp").service("authInterceptor",["$rootScope","$q","$location","$injector",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},localStorage.token?a.headers.Authorization="Bearer "+localStorage.token:sessionStorage.token&&(a.headers.Authorization="Bearer "+sessionStorage.token),a},response:function(a){return a||b.when(a)}}}]),angular.module("voluntrApp").factory("RecordedHours",["$resource",function(a){function b(){this.service=a("/api/v1/recorded_hours/:recorded_hours_Id",{recorded_hours_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({recorded_hours_Id:a})},new b}]),angular.module("voluntrApp").factory("People",["$resource",function(a){function b(){this.service=a("/api/v1/people/:person_Id",{person_Id:"@id"},{update:{method:"PATCH"},person_object:{method:"GET",url:"/api/v1/people/:person_Id/:object",isArray:!0}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({person_Id:a})},b.prototype.recorded_hours=function(a,b){return this.service.person_object({person_Id:a,object:b})},b.prototype.opportunities=function(a,b){return this.service.person_object({person_Id:a,object:b})},new b}]),angular.module("voluntrApp").controller("ProfileCtrl",["$scope","$log","$modal","Profile","$stateParams","$rootScope",function(a,b,c,d,e,f){d.get({profile_Id:e.profile_Id},function(b){a.profile=b},function(a){}),a.open=function(b){var d=c.open({templateUrl:"views/record_hours.html",controller:"RecordHoursCtrl",windowClass:"record-hours-modal-window",size:b});d.result.then(function(){a.profile.total_hours+=f.recordedHours,f.recordedHours=null},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").controller("RecordHoursCtrl",["$scope","Event","UserEventHours","$modal","$modalInstance","$rootScope",function(a,b,c,d,e,f){a.events=b.all(),a.hours1=0,a.hours2=0,a.h1_up=function(){a.hours1<9&&(a.hours1+=1)},a.h2_up=function(){a.hours2<9&&(a.hours2+=1)},a.h1_down=function(){a.hours1>0&&(a.hours1-=1)},a.h2_down=function(){a.hours2>0&&(a.hours2-=1)},a.recordHours=function(){var b=10*a.hours1+a.hours2,d={};d.event_id=a.recordHours.event_id,d.user_id=localStorage.user_id,d.description=a.description,d.hours=b;var g=c.create(d);f.recordedHours=g.hours,e.close()}}]),angular.module("voluntrApp").factory("UserEventHours",["$resource",function(a){function b(){this.service=a("/api/v1/user_event_hours/:user_event_hours_Id",{organization_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({user_event_hours_Id:a})},new b}]),angular.module("voluntrApp").factory("Profile",["$resource",function(a){function b(){this.service=a("/api/v1/profiles/:profile_Id",{organization_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({profile_Id:a})},new b}]),angular.module("voluntrApp").factory("User",["$resource",function(a){function b(){this.service=a("/api/v1/users/:user_Id",{user_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.get=function(a,b,c){this.service.get(a,b,c)},b.prototype.update=function(a){return this.service.update(a)},new b}]),angular.module("voluntrApp").factory("searchService",function(){return{search:{query:""}}}),angular.module("voluntrApp").factory("MailingServiceList",["$resource",function(a){function b(){this.service=a("/api/v1/mailing_service_list/:mailing_service_list_Id",{mailing_service_list_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.all=function(){return this.service.query()},b.prototype.update=function(a){return this.service.update(a)},new b}]),angular.module("voluntrApp").factory("Group",["$resource",function(a){function b(){this.service=a("/api/v1/groups/:group_Id",{group_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.all=function(){return this.service.query()},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},new b}]),angular.module("voluntrApp").factory("OrganizationMailingService",["$resource",function(a){function b(){this.service=a("/api/v1/organization_mailing_services/:organization_mailing_service_Id",{organization_mailing_service_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.all=function(){return this.service.query()},b.prototype.update=function(a){return this.service.update(a)},b.prototype["delete"]=function(a){return this.service.remove({organization_mailing_service_Id:a})},new b}]),angular.module("voluntrApp").controller("ProfileCreateCtrl",["$scope","Profile","$modalInstance",function(a,b,c){a.createProfile=function(){console.log("modal");var d={};d.user_id=a.user.id,d.first_name=a.createProfile.first_name,d.last_name=a.createProfile.last_name;var e=b.create(d);a.user.profile=e,c.close()}}]),angular.module("voluntrApp").controller("AddDataCtrl",["$scope","organization","Facebook","$filter",function(a,b,c,d){a.organization=b,a.toggleImpressionDataOnLineGraph=function(b,d,e){var f={name:e,data:[]},g=[];angular.forEach(b,function(a){var b=[];if("shared_post"!==d)var c={method:"GET",relative_url:"/"+a.id+"/insights/"+d+"/lifetime"};else if("shared_post"===d)var c={method:"GET",relative_url:"/"+a.id+"/sharedposts/"};b[0]=a.created_time,g.push(c),f.data.push(b)}),c.api("/","POST",{batch:g,include_headers:!1},function(a){for(var b=a.length-1;b>=0;b--){var c=a[b],e=JSON.parse(c.body);"shared_post"!==d?(console.log(f),f.data[b][1]=e.data[0].values[0].value):"shared_post"===d&&(f.data[b][1]=e.data.length)}}),a.lineGraphConfig.series.push(f),console.log(f.data),console.log(a.lineGraphConfig.series)}}]),angular.module("voluntrApp").controller("LandingPageCtrl",["$scope","Facebook","Organization","$http","$state","Auth","$rootScope","$location","$window","$modal",function(a,b,c,d,e,f,g,h,i,j){var k=$(".nav").offset().top;console.log(k);var l=function(){var a=$("#screen2").offset().top;console.log(a),0>a?$(".nav").addClass("sticky"):$(".nav").removeClass("sticky")};l(),$(".ng-scope").scroll(function(){console.log("HELLO COWBOY"),l()}),$(".fadein img:gt(0)").hide(),setInterval(function(){$(".fadein :first-child").fadeOut().next("img").fadeIn().end().appendTo(".fadein")},4e3),$(".screen1button").click(function(){$("#login").fadeIn(400)}),$(".close").click(function(){$("#login").fadeOut(400)}),$(".navicon").click(function(){$(".navmenu").toggleClass("navb")}),$(".ng-scope").click(function(a){a.preventDefault(),$(".container-fluid").scrollTo(this.hash,this.hash),console.log("ddd")}),$(".navmenu a").click(function(){$(".navmenu").addClass("navb"),console.log("menu close")}),a.newContact=function(){d.post("/api/v1/user/contact_form",{email:a.newContact.contact_email,content:a.newContact.contact_content}).success(function(b,c,d,e){alert("Thanks for Contacting Us, We Will Respond Soon!"),a.newContact.contact_email="",a.newContact.contact_content=""}).error(function(b,c,d,e){alert("Thanks for Contacting Us, We Will Respond Soon!"),a.newContact.contact_email="",a.newContact.contact_content=""})},a.open_lp_modal=function(b){var c=j.open({templateUrl:"views/tos_privacy.html",controller:"LandingPageCtrl",size:b});c.result.then(function(){a.profile.total_hours+=g.recordedHours,g.recordedHours=null},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").controller("OrganizationRegistrationCtrl",["$scope","Facebook","$http","Organization","$state","$stateParams",function(a,b,c,d,e,f){a.log_in=function(){b.login(function(b){a.oauth_key=b.authResponse.accessToken,e.go(e.current,{},{reload:!0})},{scope:"user_groups,read_insights,manage_pages"})};var g=function(c){if(!a.organizations){var e=[];a.organizations=e}b.api("/"+c.id+"/picture",{type:"large"},function(a){c.picture=a.data.url}),d.existence_check(c.id).$promise.then(function(b){b.id?(c.exists=!0,c.v_id=b.id):b.id||(c.exists=!1),a.organizations.push(c)})};b.getLoginStatus(function(b){"connected"===b.status?(a.connected_to_facebook=!0,a.oauth_key=b.authResponse.accessToken,console.log(a.oauth_key)):"connected"!==b.status&&(a.connected_to_facebook=!1)}),a.authorizeUser=function(b){d.authorization(a.oauth_key,b.v_id).$promise.then(function(a){localStorage.token=a.token,e.go("organizations.organization_home",{organization_Id:a.organization.id})})},a.$watch("connected_to_facebook",function(){a.connected_to_facebook&&!a.organizations&&b.api("/me/accounts",function(a){angular.forEach(a.data,g)})}),a.addOrganization=function(b){a.organization=b;var c={};c.fb_id=b.id,c.name=b.name,c.description=b.description,c.oauth_key=a.oauth_key;d.create(c).$promise.then(function(a){localStorage.token=a.token,e.go("organizations.tutorial.1",{organization_Id:a.organization.id}),f.organization_Id=a.id})},a.organizationRegistration=function(c){a.organization_registration=!0,b.api("/"+c.id,function(a){c.description=a.description}),a.organization=c},a.organizationList=function(){a.organization_registration=!1}}]),angular.module("voluntrApp").controller("OrganizationMainCtrl",["$scope","Facebook","$stateParams","$http","$state","$filter","uiCalendarConfig","$rootScope",function(a,b,c,d,e,f,g,h){a.$on("$stateChangeSuccess",function(){a.current_state=e.current.name,h.organization_id=e.params.organization_Id})}]),angular.module("voluntrApp").controller("OrganizationHomeCtrl",["$scope","Facebook","Organization","$stateParams","$state","Opportunity","$http","$filter","$parse","$modal","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(b){a.lineGraphConfig.series[0].data.push([Date.parse(b.post_time),Number(b.likes)])},m=function(b){a.lineGraphConfig.series[1].data.push([Date.parse(b.date),Number(b.total_recorded_hours)]),a.lineGraphConfig.series[2].data.push([Date.parse(b.date),Number(b.planned_hours)]),a.lineGraphConfig.series[3].data.push([Date.parse(b.date),Number(b.total_added_volunteers)])};a.loaded=!1,b.getLoginStatus(function(b){"connected"===b.status?c.get({organization_Id:d.organization_Id,oauth_key:b.authResponse.accessToken},function(b){a.organization=b,k.organization_id=b.id,c.recorded_hours(b.id,"recorded_hours").$promise.then(function(b){a.organization.recorded_hours=b}),c.daily_statistics(b.id,"daily_statistics").$promise.then(function(b){a.organization.daily_statistics=h("orderBy")(b,"date"),angular.forEach(a.organization.daily_statistics,m)}),c.contact_volunteers(b.id,"contact_volunteers").$promise.then(function(b){a.organization.contact_volunteers=b}),c.posts(b.id,"posts").$promise.then(function(b){a.organization.posts=a.organization.posts=h("orderBy")(b,"post_time"),angular.forEach(a.organization.posts,l)})}).$promise.then(function(){a.loaded=!0}):"connected"!==b.status&&e.go("landing_page.initial_page")}),k.lineGraphConfig={options:{chart:{type:"spline",zoomType:"xy"}},xAxis:{type:"datetime",title:{text:"Date"}},yAxis:{allowDecimals:!1,floor:0},series:[{name:"Post Likes",data:[]},{name:"Total Recorded Volunteer Hours",data:[]},{name:"Total Planned Volunteer Hours",data:[]},{name:"Total Added Volunteers",data:[]}],title:{text:"Your Organization's Timeline"},loading:!1,size:{height:"250"}}}]),angular.module("voluntrApp").controller("OrganizationAccountCtrl",["$scope","Organization","$stateParams","$state","$rootScope","$http","$window","ENV","OrganizationMailingService","Facebook","Upload","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){b.get({organization_Id:c.organization_Id},function(b){a.organization=b,j.api("/"+b.fb_id+"/picture",{type:"large"},function(b){a.organization.picture=b.data.url})}),a.authorize_mailchimp=function(){g.location.href="https://login.mailchimp.com/oauth2/authorize?client_id="+h.mailchimp_id+"&response_type=code&state="+btoa(c.organization_Id)},f({url:"api/v1/organizations/"+c.organization_Id+"/auth/mail_chimp_check",method:"get"}).success(function(b){b.response?(a.mailchimp_authorized=!0,a.mailchimp=JSON.parse(b.response.body)):b.response||(a.mailchimp_authorized=!1)}).error(function(a){}),a["delete"]=function(b){i["delete"](b.id);var c=a.organization.organization_mailing_services.indexOf(b);c>-1&&a.organization.organization_mailing_services.splice(c,1),a.mailchimp_authorized=!1},a.uploadFiles=function(b){a.f=b,b&&!b.$error&&(b.upload=k.upload({url:"api/v1/organizations/"+a.organization.id,method:"PATCH",file:{"organization[terms_of_service_file]":b}}),b.upload.then(function(a){l(function(){b.result=a.data})},function(b){b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))}))}}]),angular.module("voluntrApp").controller("OrganizationVolunteerRegistrationCtrl",["$scope","$stateParams","$http","$state","$filter","$rootScope","Facebook","Organization","People","$timeout",function(a,b,c,d,e,f,g,h,i,j){h.get_by_url({organization_custom_Url:b.organization_custom_Url},function(b){a.organization=b,g.api("/"+b.fb_id+"/picture",{type:"large"},function(b){a.organization.picture=b.data.url}),a.submittable=!1,d.params.person_token?d.params.person_token&&i.get({person_Id:atob(d.params.person_token)},function(b){a.person=b}):a.person={}}),a.$watchGroup(["person.first_name","person.last_name","person.email"],function(){a.person.first_name&&a.person.last_name&&a.person.email?a.submittable=!0:a.person.first_name&&a.person.last_name&&a.person.email||(a.submittable=!1)}),a.createPerson=function(b){var c={};c.email=b.email,c.first_name=b.first_name,c.last_name=b.last_name,c.organization_id=a.organization.id,d.params.person_token?d.params.person_token&&i.update(c).$promise.then(function(b){a.person=b,d.go("organization_volunteer_registration.2",{person_token:btoa(a.person.id)})}):i.create(c).$promise.then(function(b){a.person=b,d.go("organization_volunteer_registration.2",{person_token:btoa(a.person.id)})})},a.updateWithAddress=function(b){var c={};c.id=a.person.id,c.address_1=b.address_1,c.address_2=b.address_2,c.state=b.state,c.city=b.city,c.zip_code=b.zip_code,i.update(c).$promise.then(function(b){a.person=b,d.go("organization_volunteer_registration.3",{person_token:btoa(a.person.id)})})},a.morning={},a.afternoon={},a.night={},a.updateWithSchedule=function(){var b={};b.id=a.person.id,b.schedule={},b.schedule.morning=a.morning,b.schedule.afternoon=a.afternoon,b.schedule.night=a.night,i.update(b).$promise.then(function(b){d.go("organization_volunteer_registration.4",{person_token:btoa(a.person.id)})})},a.updateWithAdditionalInformation=function(b){var c={};c.id=a.person.id,c.phone=b.phone,c.organization_name=b.organization_name,c.occupation=b.occupation,i.update(c).$promise.then(function(a){d.go("volunteer_home")})}}]),angular.module("voluntrApp").controller("GenerateReportCtrl",["$scope","$modal","$rootScope","$http","$stateParams","rm_id","$window","type","$modalInstance",function(a,b,c,d,e,f,g,h,i){a.date={startDate:null,endDate:null},a.report_loaded=!1,a.exportReport=function(){a.report_loaded=!0;var b=window.open("about:blank","_blank");"opportunity"===h?d.get("api/v1/reports/opportunity/"+f,{params:{start_date:a.date.startDate,end_date:a.date.endDate},headers:{"Content-Type":"application/pdf"}}).success(function(a){b.location.href=a.resource.resource.url}):"person"==h&&d.get("api/v1/reports/person/"+f,{params:{start_date:a.date.startDate,end_date:a.date.endDate,organization_id:e.organization_Id},headers:{"Content-Type":"application/pdf"}}).success(function(a){console.log(a),b.location.href=a.resource.resource.url}),i.close()}}]),angular.module("voluntrApp").controller("OrganizationTutorialCtrl",["$scope","$modal","$rootScope","$http","$stateParams","searchService","$window","$state",function(a,b,c,d,e,f,g,h){a.$watch("current_state",function(){"organizations.tutorial.1"===a.current_state?(a.link_text="Importing People To Your Organization",a.link_state="organizations.tutorial.2"):"organizations.tutorial.2"===a.current_state?(a.back_link_text="Back to Introduction",a.back_link_state="organizations.tutorial.1",a.link_text="Read About Adding Opportunities and Volunteers",a.link_state="organizations.tutorial.3"):"organizations.tutorial.3"===a.current_state?(a.back_link_text="Back to Importing Your Data on Volu",a.back_link_state="organizations.tutorial.2",a.link_text="Read About Registering Your Volunteers",a.link_state="organizations.tutorial.4"):"organizations.tutorial.4"===a.current_state?(a.back_link_text="Back to Quickly Adding Objects on Volu",a.back_link_state="organizations.tutorial.3",a.link_text="Read About Finding Things on Volu",a.link_state="organizations.tutorial.5"):"organizations.tutorial.5"===a.current_state?(a.back_link_text="Back to Registering Volunteers on Volu",a.back_link_state="organizations.tutorial.4",a.link_text="Read About How Volu Integrates With Your Current Services",a.link_state="organizations.tutorial.6"):"organizations.tutorial.6"===a.current_state&&(a.back_link_text="Back to Integrating Services With Volu",a.back_link_state="organizations.tutorial.5",a.link_text="Access Your Dashboard")}),a.backFunction=function(){h.go(a.back_link_state)},a.forwardFunction=function(){return"organizations.tutorial.6"===a.current_state?void h.go("organizations.organization_home",{organization_Id:e.organization_Id}):void h.go(a.link_state)}}]),angular.module("voluntrApp").controller("GroupsHomeCtrl",["$scope","$modal","Group",function(a,b,c){a.loaded=!1,c.all().$promise.then(function(b){a.loaded=!0,a.groups=b})}]),angular.module("voluntrApp").controller("PeopleHomeCtrl",["$scope","Facebook","$http","$stateParams","$modal","Organization","$filter",function(a,b,c,d,e,f,g){function h(b){a.people=b,a.loaded=!0}function i(){a.deferred=a.onChange()}a.loaded=!1,f.get({organization_Id:d.organization_Id}).$promise.then(function(b){a.total_people_count=b.total_people}),a.selected=[],a.filter={options:{debounce:500}},a.query={filter:"",limit:"5",order:"first_name",page:1,contact_only:!1},a.onChange=function(){return f.people(d.organization_Id,"people",a.query).$promise.then(function(b,c,d,e){a.loaded=!0,h(b)})},a.onPaginationChange=function(){return f.people(d.organization_Id,"people",a.query).$promise.then(function(b,c,d,e){a.loaded=!0,console.log(b),h(b)})},a.removeFilter=function(){a.filter.show=!1,a.query.filter="",a.filter.form.$dirty&&a.filter.form.$setPristine()},a.$watchGroup(["query.filter","query.order","query.limit"],function(b,c){if(!c)var d=a.query.page;b!==c&&(a.query.page=1),b||(a.query.page=d),i()}),a.filterByContactInformation=function(){i()},a.bulkAddPeople=function(a){var b=e.open({templateUrl:"organizations/modals/bulk_add_people_modal.html",controller:"BulkAddPeopleCtrl",windowClass:"add-event-modal-window",size:a});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").controller("OpportunitiesHomeCtrl",["$scope","Facebook","$stateParams","$http","$state","$filter","uiCalendarConfig","$modal","Opportunity",function(a,b,c,d,e,f,g,h,i){a.eventSources=[{url:"api/v1/organizations/"+c.organization_Id+"/opportunities"},[]],a.uiConfig={myCalendar:{height:500,editable:!0,eventTextColor:"white",header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},businessHours:{start:"7:00",end:"20:00",dow:[1,2,3,4,5]}}},a.opportunityDetail=function(a,b,c){var e=h.open({templateUrl:"organizations/modals/opportunity_detail_modal.html",controller:"OpportunityDetailCtrl",windowClass:"add-event-modal-window",size:a,resolve:{id:function(){return b},start_time:function(){return c},opportunity:function(){return d.get("api/v1/opportunities/"+b,{params:{
instance_date:new Date(c).getTime()}}).success(function(a,b,c,d){})}}});e.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.uiConfig.myCalendar.eventClick=function(b,c,d){console.log(b._start._i),a.opportunityDetail("lg",b.id,b._start._i)}}]),angular.module("voluntrApp").controller("OpportunityRegistrationCtrl",["$scope","People","$stateParams","Opportunity","PersonOpportunity","$modal","Organization","Facebook",function(a,b,c,d,e,f,g,h){d.get({opportunity_Id:c.opportunity_Id},function(b){a.opportunity=b,g.get({organization_Id:b.organization_id},function(b){h.api("/"+b.fb_id+"/picture",{type:"large"},function(b){a.organization_picture=b.data.url})})}),a.registerForOpportunity=function(){if(a.opportunityRegister.first_name&&a.opportunityRegister.last_name&&a.opportunityRegister.email){var b={};b.opportunity_id=c.opportunity_Id,b.first_name=a.opportunityRegister.first_name,b.last_name=a.opportunityRegister.last_name,b.email=a.opportunityRegister.email,e.create(b),a.opportunityRegister.first_name="",a.opportunityRegister.last_name="",a.opportunityRegister.email="",a.opportunityRegistrationConfirmation("md")}else alert("Please Enter All Information")},a.opportunityRegistrationConfirmation=function(a){var b=f.open({templateUrl:"organizations/modals/confirm_opportunity_registration.html",controller:"OpportunityRegistrationConfirmationCtrl",windowClass:"add-event-modal-window",size:a});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").controller("OpportunitySignInCtrl",["$scope","People","$stateParams","Opportunity","PersonOpportunity","$modal","$filter","Facebook","Organization",function(a,b,c,d,e,f,g,h,i){d.get({opportunity_Id:c.opportunity_Id},function(b){a.opportunity=b,h.api("/"+b.organization.fb_id+"/picture",{type:"large"},function(b){a.organization_picture=b.data.url})}),a.terms_of_service=!0,a.$watchGroup(["opportunitySignIn.first_name","opportunitySignIn.last_name","opportunitySignIn.email","opportunitySignIn.phone"],function(){a.opportunitySignIn.first_name&&a.opportunitySignIn.last_name&&(a.opportunitySignIn.email||a.opportunitySignIn.phone)?(a.opportunitySignIn.first_name||a.opportunitySignIn.last_name||a.opportunitySignIn.email||a.opportunitySignIn.phone)&&(a.form_complete=!0):a.form_complete=!1}),a.signInForOpportunity=function(){var c={};c.first_name=a.opportunitySignIn.first_name,c.last_name=a.opportunitySignIn.last_name,c.email=a.opportunitySignIn.email,c.phone=a.opportunitySignIn.phone,c.organization_id=a.opportunity.organization_id;var d=b.create(c);a.opportunitySignIn.first_name="",a.opportunitySignIn.last_name="",a.opportunitySignIn.email="",a.opportunitySignIn.phone="",a.opportunitySignInConfirmation("md",d,a.opportunity)},a.opportunitySignInConfirmation=function(a,b,c){var d=f.open({templateUrl:"organizations/modals/confirm_opportunity_sign_in.html",controller:"OpportunitySignInConfirmationCtrl",windowClass:"add-event-modal-window",resolve:{person:function(){return b},opportunity:function(){return c}},size:a});d.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.opportunitySignIn={},a.opportunitySignIn.first_name="",a.opportunitySignIn.last_name="",a.opportunitySignIn.email="",a.$watchGroup(["opportunitySignIn.first_name","opportunitySignIn.last_name","opportunitySignIn.email"],function(){""!==a.opportunitySignIn.first_name||""!==a.opportunitySignIn.last_name||""!==a.opportunitySignIn.email?(a.registration_found=!0,a.filtered=g("filter")(a.opportunity.signed_up_volunteers,{first_name:a.opportunitySignIn.first_name,last_name:a.opportunitySignIn.last_name,email:a.opportunitySignIn.email})):a.registration_found=!1})}]),angular.module("voluntrApp").controller("FABCtrl",["$scope","$modal","$rootScope",function(a,b,c){a.addVolunteerOpportunity=function(a){var c=b.open({templateUrl:"organizations/modals/organization_add_opportunity_modal.html",controller:"AddOpportunityCtrl",windowClass:"add-event-modal-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.recordHours=function(a){var c=b.open({templateUrl:"organizations/modals/record_hours_modal.html",controller:"RecordHoursCtrl",windowClass:"add-event-modal-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.addOrganizationPerson=function(a){var c=b.open({templateUrl:"organizations/modals/organization_add_person_modal.html",controller:"AddPeopleCtrl",windowClass:"add-event-modal-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.addGroup=function(a){var c=b.open({templateUrl:"organizations/modals/add_group.html",controller:"AddGroupCtrl",windowClass:"add-event-modal-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").controller("SideMenuCtrl",["$scope","$stateParams","$state","Opportunity","$modal","$rootScope","$mdSidenav",function(a,b,c,d,e,f,g){a.isOpen=!1}]),angular.module("voluntrApp").controller("HeaderCtrl",["$scope","$rootScope","searchService","$window","$mdSidenav","$http","$stateParams","$timeout","$modal",function(a,b,c,d,e,f,g,h,i){a.search_filter=c.search,a.isOpen=!1,a.demo={isOpen:!1,count:0,selectedAlignment:"md-right"},a.supportModal=function(b){var c=i.open({templateUrl:"organizations/modals/support_form.html",controller:"SupportFormCtrl",windowClass:"add-event-modal-window",size:b,resolve:{current_state:function(){return a.current_state}}});c.result.then(function(){},function(){})},a.open=function(){e("left").open().then(function(){a.menu_open=!0})};var j=function(b){var c=b._source,d={};"organization_person"==b._type&&c.person&&c.person.first_name&&c.person.first_name?(d.id=c.person_id,d.type="person",d.title=c.person.first_name+" "+c.person.last_name):"opportunity"==b._type&&(d.id=c.id,d.type="opportunity",d.title=c.name),a.results.push(d)};a.$watch("search_query",function(){a.loaded=!1,a.results=[],console.log(a.search_query),a.search_query&&!a.loading?(a.searching=!0,f({url:"api/v1/organizations/"+g.organization_Id+"/search",params:{query:a.search_query}}).success(function(b,c,d,e){angular.forEach(b,j),a.loading=!1,a.loaded=!0}).error(function(a,b,c,d){})):a.search_query||(a.searching=!1)}),a.close=function(){e("left").close().then(function(){a.menu_open=!1})},a.openModal=function(a){if("person"===a.type){var b=i.open({templateUrl:"organizations/modals/person_detail_modal.html",controller:"PersonDetailCtrl",windowClass:"add-event-modal-window",size:"lg",resolve:{id:function(){return a.id}}});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}else if("opportunity"===a.type){var c=i.open({templateUrl:"organizations/modals/opportunity_detail_modal.html",controller:"OpportunityDetailCtrl",windowClass:"add-event-modal-window",size:"lg",resolve:{id:function(){return a.id},start_time:function(){return 0}}});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}}]),angular.module("voluntrApp").controller("VolunteerHomeCtrl",["$scope","geolocation","Opportunity","Organization","$http","$timeout","$modal","$rootScope","leafletData",function(a,b,c,d,e,f,g,h,i){b.getLocation().then(function(b){a.coords={lat:b.coords.latitude,"long":b.coords.longitude},a.markers={m1:{lat:a.coords.lat,lng:a.coords["long"],focus:!0,message:"Your Current Location"}}}),a.getDistance=function(b){var c=new google.maps.LatLng(a.coords.lat,a.coords["long"]);!b.distance&&b.latitude&&b.longitude&&f(function(){function d(c,d){d==google.maps.DistanceMatrixStatus.OK?(console.log(c.rows[0].elements[0]),b.distance=c.rows[0].elements[0].distance.text,a.event=b):d!==google.maps.DistanceMatrixStatus.OK&&console.log(d)}var e=c,f=new google.maps.LatLng(b.latitude,b.longitude),g=new google.maps.DistanceMatrixService;g.getDistanceMatrix({origins:[e],destinations:[f],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.IMPERIAL},d)},700)};var j=function(b){b.latitude&&b.longitude&&(a.markers[b.name]={lat:b.latitude,lng:b.longitude,message:b.name})};a.$watch("markers",function(){a.markers&&c.all().$promise.then(function(b){angular.forEach(b,j),a.opportunities=b})})}]),angular.module("voluntrApp").controller("PersonDetailCtrl",["$scope","Facebook","$http","$stateParams","id","People","$timeout",function(a,b,c,d,e,f,g){var h=function(b){null!=b.date_recorded&&a.personStatisticGraphConfig.series[0].data.push([Date.parse(b.date_recorded),b.hours])},i=function(b){a.personOpportunitiesChart.series[0].data.push([b.opportunity.name,b.total_hours])};f.get({person_Id:e},function(b){a.person=b,f.recorded_hours(e,"recorded_hours").$promise.then(function(b){a.person.recorded_hours=b,angular.forEach(b,h)}),f.opportunities(e,"opportunities").$promise.then(function(b){a.person.opportunities=b,angular.forEach(a.person.opportunities,i)})}),a.personStatisticGraphConfig={options:{chart:{type:"spline",zoomType:"xy",renderTo:"container"}},xAxis:{type:"datetime",title:{text:"Date"}},yAxis:{allowDecimals:!1,floor:0},series:[{name:"Recorded Hours",data:[]}],title:{text:"Person Dashboard"},loading:!1,noData:"This Person Hasn't Volunteered Yet!",size:{height:"250"}},a.personOpportunitiesChart={options:{chart:{type:"pie",zoomType:"xy"}},series:[{name:"Recorded Hours",data:[]}],title:{text:"Person Opportunities Distribution"},loading:!1,size:{height:"250"}},g(function(){window.dispatchEvent(new Event("resize")),50})}]),angular.module("voluntrApp").controller("GroupDetailCtrl",["$scope","id","Group","$timeout",function(a,b,c,d){var e=function(b){a.groupStatisticGraphConfig.series[0].data.push([Date.parse(b.date_recorded),Number(b.hours)])};c.get({group_Id:b},function(b){a.group=b,angular.forEach(b.recorded_hours,e)}),a.groupStatisticGraphConfig={options:{chart:{type:"spline",zoomType:"xy",renderTo:"container"}},xAxis:{type:"datetime",title:{text:"Date"}},yAxis:{allowDecimals:!1,floor:0},series:[{name:"Recorded Hours",data:[]}],title:{text:"Group Dashboard"},loading:!1,size:{height:"250"}},d(function(){window.dispatchEvent(new Event("resize")),50})}]),angular.module("voluntrApp").controller("AddPeopleCtrl",["$scope","Facebook","$stateParams","$http","$state","People","$modalInstance",function(a,b,c,d,e,f,g){a.newPerson={},a.addPerson=function(){var b={};b.id=a.newPerson.id,b.first_name=a.newPerson.first_name,b.last_name=a.newPerson.last_name,b.email=a.newPerson.email,b.phone=a.newPerson.phone,b.address=a.newPerson.address,b.city=a.newPerson.city,b.state=a.newPerson.state,b.zip_code=a.newPerson.zip_code,b.organization_id=c.organization_Id;f.create(b);g.dismiss("cancel")},a.matchedPerson=function(b){a.newPerson.id=b.id,a.newPerson.first_name=b.first_name,a.newPerson.last_name=b.last_name},d.get("api/v1/organizations/"+c.organization_Id+"/people").success(function(b,c,d,e){a.organization_people=b}).error(function(a,b,c,d){console.log(a)})}]),angular.module("voluntrApp").controller("AddGroupCtrl",["$scope","$stateParams","$modalInstance","$state","Group","GroupAdministrator","People",function(a,b,c,d,e,f,g){a.administrators=[],a.createAdministrator=function(b){var c={};c.email=b.email,c.first_name=b.first_name,c.last_name=b.last_name,a.administrators.push(c),a.administrator.first_name="",a.administrator.last_name="",a.administrator.email="",console.log(a.administrators)},a.createGroup=function(){var d={};d.name=a.createGroup.group_name,d.description=a.createGroup.description,d.city=a.createGroup.city,d.state=a.createGroup.state;e.create(d).$promise.then(function(c){angular.forEach(a.administrators,function(a){console.log(a);var d={};d.first_name=a.first_name,d.last_name=a.last_name,d.email=a.email,d.organization_id=b.organization_Id;g.create(d).$promise.then(function(a){var b={};b.person_id=a.id,b.group_id=c.id,f.create(b).$promise.then(function(a){console.log(a)})})})});c.close()}}]),angular.module("voluntrApp").controller("RecordHoursCtrl",["$scope","$modal","$rootScope","RecordedHours","$stateParams","$http","People","$modalInstance","Organization","$filter",function(a,b,c,d,e,f,g,h,i,j){i.get({organization_Id:e.organization_Id},function(b){a.opportunities=b.opportunities}),a.recordHours=function(){var b={};if(b.hours=a.recordHours.hours,b.organization_id=e.organization_Id,b.description=a.description,a.opportunity&&(b.opportunity_id=a.opportunity.id),a.opportunity_role&&(b.opportunity_role_id=a.opportunity_role.id),a.new_volunteer){var c={};c.first_name=a.first_name,c.last_name=a.last_name,c.description=a.description,c.email=a.email,c.organization_id=e.organization_Id,g.create(c).$promise.then(function(a){b.person_id=a.id;d.create(b)}),h.close()}else{b.person_id=a.volunteer_id;d.create(b);h.close()}},a.selectHoursPerson=function(b){a.first_name=b.first_name,a.last_name=b.last_name,a.email=b.email,a.volunteer_id=b.id},a.organization_people=i.people(e.organization_Id,"people"),a.clearPerson=function(){a.first_name="",a.last_name="",a.email="",a.volunteer_id=""},a.first_name="",a.last_name="",a.email="",a.$watchGroup(["first_name","last_name","email"],function(){""!==a.first_name||""!==a.last_name||""!==a.email?(a.results=!0,a.filtered=j("filter")(a.organization_people,{first_name:a.first_name,last_name:a.last_name})):a.results=!1,""===a.first_name||""===a.last_name||""===a.email?a.new_volunteer_validation=!0:a.new_volunteer_validation=!1})}]),angular.module("voluntrApp").controller("AddOpportunityCtrl",["$scope","$timeout","Opportunity","$stateParams","$http","$modal","$modalInstance","OpportunityRole","$state",function(a,b,c,d,e,f,g,h,i){a.calendar={},a.calendar.repeat={},a.roles=[],a.role={},a.createRole=function(b){var c={};c.name=b.name,b.description&&(c.description=b.description),b.volunteers_required&&(c.volunteers_required=b.volunteers_required),b.hours_required&&(c.volunteers_required=b.hours_required),a.roles.push(c),a.role.name="",a.role.description="",a.role.volunteers_required="",a.role.hours_required=""},a.newOpportunity=function(){var b={};b.calendar=a.calendar,void 0!=a.calendar.start_time&&(b.calendar.start_time=a.calendar.start_time.getTime()),void 0!=a.calendar.repeat.repeat_until&&(b.calendar.repeat.repeat_until=a.calendar.repeat.repeat_until.getTime()),a.newOpportunity.volunteer_goal&&(b.volunteer_goal=a.newOpportunity.volunteer_goal),b.name=a.newOpportunity.opportunity_name,b.calendar.end_time=a.calendar.end_time,b.description=a.newOpportunity.description,b.address=a.newOpportunity.address,b.zip_code=a.newOpportunity.zip_code,b.city=a.newOpportunity.city,b.state=a.newOpportunity.state,b.organization_id=d.organization_Id,b.volunteer_goal=a.newOpportunity.volunteer_goal;c.create(b).$promise.then(function(b){angular.forEach(a.roles,function(a){a.opportunity_id=b.id,h.create(a)})});"organizations.opportunities_home"===i.current.name&&i.go(i.current,{},{reload:!0}),g.dismiss("cancel")}}]),angular.module("voluntrApp").controller("BulkAddPeopleCtrl",["$scope","$modal","$http","$stateParams","searchService","$window","XLSXReaderService","$modalInstance",function(a,b,c,d,e,f,g,h){a.showJSONPreview=!0,a.json_string="",a.fileChanged=function(b){a.isProcessing=!0,a.sheets=[],a.excelFile=b[0],g.readFile(a.excelFile,a.showPreview,a.showJSONPreview).then(function(b){a.sheets=b.sheets,console.log(a.sheets),a.isProcessing=!1})},a.updateJSONString=function(){a.json_string=JSON.stringify(a.sheets[a.selectedSheetName],null,2),angular.forEach(a.sheets[a.selectedSheetName])},a.uploadPeople=function(){var b=a.sheets[a.selectedSheetName];c.post("api/v1/people/import",{people:b,organization_id:d.organization_Id}).success(function(a,b,c,d){console.log(a),h.close()})},a.showPreviewChanged=function(){a.showPreview&&(a.showJSONPreview=!1,a.isProcessing=!0,g.readFile(a.excelFile,a.showPreview,a.showJSONPreview).then(function(b){a.sheets=b.sheets,a.isProcessing=!1}))}}]),angular.module("voluntrApp").controller("OpportunityDetailCtrl",["$scope","Facebook","$stateParams","$http","$state","Opportunity","id","PersonOpportunity","start_time","$modal","$modalInstance","$cacheFactory","$timeout","OpportunityRole","opportunity",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(b){a.instanceStatisticGraphConfig.series[0].data.push([Date.parse(b.end_time),Number(b.instance_hours)]),a.instanceStatisticGraphConfig.series[1].data.push([Date.parse(b.end_time),Number(b.instance_people_count)])},q=function(b){a.opportunityRolesChart.series[0].data.push([b.name,b.total_recorded_hours])};a.opportunity=o.data,f.instance_statistics(a.opportunity.id,"instance_statistics").$promise.then(function(a){angular.forEach(a,p)}),f.volunteers(a.opportunity.id,"volunteers").$promise.then(function(b){a.opportunity.volunteers=b}),f.roles(a.opportunity.id,"roles").$promise.then(function(b){a.opportunity.opportunity_roles=b,angular.forEach(a.opportunity.opportunity_roles,q)}),f.roles(a.opportunity.id,"recorded_hours").$promise.then(function(b){a.opportunity.recorded_hours=b}),l.current_calendar={},l.current_calendar.schedule=a.opportunity.ical,l.current_calendar.id=a.opportunity.id,l.current_calendar.type="Opportunity",l.current_calendar.start_time=new Date(parseInt(a.opportunity.start_time)),l.current_calendar.duration=a.opportunity.duration,a.opportunity_role={},a.createOpportunityRole=function(b){var c={};c.name=b.name,c.opportunity_id=a.opportunity.id,c.volunteers_required=b.volunteers_required,c.hours_required=b.hours_required,c.description=b.description,n.create(c).$promise.then(function(b){a.opportunity.opportunity_roles.push(b),a.opportunity_role.name="",a.opportunity_role.volunteers_required="",a.opportunity_role.hours_required="",a.opportunity_role.description=""})},a.updateOpportunityRole=function(b){var c={};c.id=b.id,c.name=b.name,c.description=b.description,c.volunteers_required=b.volunteers_required,c.hours_required=b.hours_required;var b=n.update(c);a.editing=!1},a.deleteOpportunityRole=function(b){var c=a.opportunity.opportunity_roles.indexOf(b);c>-1&&a.opportunity.opportunity_roles.splice(c,1),n["delete"](b.id),a.opportunity_role.name="",a.opportunity_role.description=""},a.getArray=function(){var b=[];return angular.forEach(a.opportunity.volunteers,function(a){var c={};c.first_name=a.first_name,c.last_name=a.last_name,c.email_address=a.email,c.hours=a.opportunity_hours,b.push(c)}),b};var r=[],s=function(a){r.push(a)};a.exportReport=function(){angular.forEach(a.instanceStatisticGraphConfig.series,s);var b={title:{text:"Opportunity Dashboard"},xAxis:{type:"datetime",title:{text:"Date"}},series:r},c=(JSON.stringify(b),"async=false&type=png&width=300&options="+encodeoptionsStr);d.get("api/v1/reports/opportunities/"+g,{params:{url:c}}).success(function(a){console.log(a)})};var t=function(b){var c=b._source,d={};d.id=c.person_id,d.first_name=c.person.first_name,d.last_name=c.person.last_name,d.score=b.score,a.organization_people.push(d)};a.searching=!1,a.people_search=function(b){b&&!a.searching?(a.no_search=!1,a.organization_people=[],a.searching=!0,d({url:"api/v1/organizations/"+c.organization_Id+"/people_search",params:{query:b}}).success(function(b,c,d,e){angular.forEach(b,t),a.searching=!1}).error(function(a,b,c,d){})):b||(a.searching=!1,a.no_search=!0)},a.registerFormPreview=function(a,b){var c=j.open({templateUrl:"organizations/opportunities/registration_form.html",controller:"OpportunityRegistrationCtrl",windowClass:"add-event-modal-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.signInFormPreview=function(a,b){var c=j.open({templateUrl:"organizations/opportunities/sign_in_form.html",controller:"OpportunitySignInCtrl",windowClass:"add-event-modal-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.instanceStatisticGraphConfig={options:{chart:{type:"spline",zoomType:"xy",renderTo:"container"}},xAxis:{type:"datetime",title:{text:"Date"}},yAxis:{allowDecimals:!1,floor:0},series:[{name:"Recorded Hours",data:[]},{name:"People Recording",data:[]}],title:{text:"Opportunity Dashboard"},loading:!1,size:{height:"250"}},a.opportunityRolesChart={options:{chart:{type:"pie",zoomType:"xy"}},series:[{name:"Recorded Hours",data:[]}],title:{text:"Hours Recorded For Roles"},loading:!1,size:{height:"250"}},m(function(){window.dispatchEvent(new Event("resize")),50})}]),angular.module("voluntrApp").controller("AddOpportunityPersonCtrl",["$scope","Facebook","$stateParams","$http","$state","opportunity","PersonOpportunity","$modal","start_time","$modalInstance",function(a,b,c,d,e,f,g,h,i,j){a.opportunity=f,a.instance=i._start._i,d({url:"api/v1/opportunities/"+a.opportunity.id+"/instance",method:"GET",params:{instance_date:a.instance}}).then(function(b){a.instance_volunteers=b.data.instance_volunteers}),a.addOpportunityPerson=function(){var b={};b.person_id=a.person.id,b.instance=a.instance,a.opportunity_role&&(b.opportunity_role_id=a.opportunity_role.id),b.opportunity_id=f.id,g.create(b),j.close()}}]),angular.module("voluntrApp").controller("OpportunityRegistrationConfirmationCtrl",["$scope","$modal","$modalInstance",function(a,b,c){a.cancel=function(){c.dismiss("cancel")}}]),angular.module("voluntrApp").controller("OpportunitySignInConfirmationCtrl",["$scope","$modal","$modalInstance","$stateParams","person","opportunity","RecordedHours","$timeout","Idle","Keepalive","Group",function(a,b,c,d,e,f,g,h,i,j,k){a.groups=k.all(),a.opportunity=f,a.photo_consent=!0,a.hours=1,a.timeDuration=function(){var b={};b.hours=a.hours,b.date_recorded=(new Date).toString(),void 0!==a.opportunity_role&&(b.opportunity_role_id=a.opportunity_role.id),void 0!==a.group&&(b.group_id=a.group.id),b.person_id=e.id,b.opportunity_id=d.opportunity_Id,b.organization_id=f.organization_id,b.photo_consent=a.photo_consent,b.sign_in=!0,g.create(b),a.confirmed=!0,h(function(){c.dismiss("cancel")},1e3)},a.$watch("opportunity_role",function(){a.opportunity_role.hours_required&&(a.hours=a.opportunity_role.hours_required)}),i.watch(),a.$on("IdleTimeout",function(){a.timeDuration()})}]),angular.module("voluntrApp").controller("EditScheduleCtrl",["$scope","$cacheFactory","Opportunity","$modalInstance",function(a,b,c,d){var e=function(b){"MO"===b?a.calendar.repeat.monday_repeat=!0:"TU"===b?a.calendar.repeat.tuesday_repeat=!0:"WE"===b?a.calendar.repeat.wednesday_repeat=!0:"TH"===b?a.calendar.repeat.thursday_repeat=!0:"FR"===b?a.calendar.repeat.friday_repeat=!0:"SA"===b?a.calendar.repeat.saturday_repeat=!0:"SU"===b&&(a.calendar.repeat.sunday_repeat=!0)};b.current_calendar&&(a.editing_calendar=!0,a.calendar=b.current_calendar,a.calendar.schedule&&(a.calendar.repeating_event=!0,a.calendar.repeat={},a.calendar.repeat.repeat_count=parseInt(a.calendar.schedule.INTERVAL),"DAILY"===a.calendar.schedule.FREQ?a.calendar.repeat.repeat_daily=!0:"WEEKLY"===a.calendar.schedule.FREQ?a.calendar.repeat.repeat_weekly=!0:"MONTHLY"===a.calendar.schedule.FREQ?a.calendar.repeat.repeat_monthly=!0:"ANNUALLY"===a.calendar.schedule.FREQ&&(a.calendar.repeat.repeat_annually=!0),angular.forEach(a.calendar.schedule.BYDAY,e))),a.updateSchedule=function(){var b={};b.calendar=a.calendar,a.calendar.start_time&&(b.calendar.start_time=a.calendar.start_time.getTime()),a.calendar.repeat.repeat_until&&(b.calendar.repeat.repeat_until=a.calendar.repeat.repeat_until.getTime()),b.id=a.calendar.id,c.update(b),d.close()}}]),angular.module("voluntrApp").controller("AddResourceCtrl",["$scope","$modal","$modalInstance",function(a,b,c){}]),angular.module("voluntrApp").controller("PreviewEmailTemplateCtrl",["$scope","$modal","$modalInstance",function(a,b,c){}]),angular.module("voluntrApp").controller("SupportFormCtrl",["$scope","$rootScope","searchService","$window","$http","$stateParams","$timeout","$modal","current_state","$modalInstance",function(a,b,c,d,e,f,g,h,i,j){a.current_state=i,a.submitFeedback=function(){var b={};b.email=a.email,b.description=a.description,b.current_state=i,e.post("api/v1/administration/feedback",{data:b}).$promise.then(function(a){}),j.close()}}]),angular.module("voluntrApp").controller("TOSCtrl",["$scope","Organization","$modalInstance","organization_id","$sce",function(a,b,c,d,e){b.get({organization_Id:d},function(b){a.organization=b,a.pdfUrl=a.organization.terms_of_service_file.terms_of_service_file.url})}]),angular.module("voluntrApp").directive("scroll",["$window",function(a){return function(b,c,d){angular.element(a).bind("scroll",function(){console.log("Keep scrolling scrolling scrolling"),b.sticky=!0,b.$apply()})}}]),angular.module("voluntrApp").directive("groupModal",["$modal",function(a){function b(b,c,d){c.bind("click",function(){var b=a.open({templateUrl:"organizations/modals/group_detail_modal.html",controller:"GroupDetailCtrl",windowClass:"add-event-modal-window",size:d.size,resolve:{id:function(){return d.id}}});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})})}return{link:b}}]),angular.module("voluntrApp").directive("personModal",["$modal",function(a){function b(b,c,d){c.bind("click",function(){var b=a.open({templateUrl:"organizations/modals/person_detail_modal.html",controller:"PersonDetailCtrl",windowClass:"add-event-modal-window",size:d.size,resolve:{id:function(){return d.id}}});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})})}return{link:b}}]),angular.module("voluntrApp").directive("opportunityModal",["$modal",function(a){function b(b,c,d){c.bind("click",function(){var b=a.open({templateUrl:"organizations/modals/opportunity_detail_modal.html",controller:"OpportunityDetailCtrl",windowClass:"add-event-modal-window",size:d.size,resolve:{id:function(){return d.id},start_time:function(){return d.start_time?start_time:d.start_time?void 0:0}}});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})})}return{link:b}}]),angular.module("voluntrApp").directive("editObjectDirective",function(){return{transclude:!0,templateUrl:"organizations/directives/edit_object_directive.html",scope:{text:"@",size:"@",modelType:"@",attributeName:"@",modelId:"@",placeholder:"@"},restrict:"E",controller:["$scope","Opportunity","Organization","People",function(a,b,c,d){"title_text"===a.size?a.title_text=!0:"subtitle_text"===a.size?a.subtitle_text=!0:"paragraph_text"===a.size&&(a.paragraph_text=!0),a.editText=function(){a.editing=!0},a.updateText=function(){if(a.editing=!1,a.text=a.text,"opportunity"===a.modelType){var e={};e.id=a.modelId,e[a.attributeName]=a.text,b.update(e)}if("organization"===a.modelType){var e={};e.id=a.modelId,e[a.attributeName]=a.text,c.update(e)}if("person"===a.modelType){var e={};e.id=a.modelId,e[a.attributeName]=a.text,d.update(e)}}}]}}),angular.module("voluntrApp").directive("objectSchedule",function(){return{transclude:!0,templateUrl:"organizations/directives/object_schedule.html",scope:{objectType:"@",object:"="},restrict:"E",controller:["$scope","$modal",function(a,b){console.log(a.object),a.eventSources=[{url:"api/v1/"+a.objectType+"/"+a.object.id+"/schedule"}],a.editSchedule=function(a){var c=b.open({templateUrl:"organizations/modals/edit-schedule.html",controller:"EditScheduleCtrl",windowClass:"edit-schedule-window",size:a});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})},a.uiConfig={myCalendar:{height:500,editable:!0,header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},businessHours:{start:"7:00",end:"20:00",dow:[1,2,3,4,5]}}},a.uiConfig.myCalendar.eventClick=function(c,d,e){if("opportunity"==a.objectType){var f=b.open({templateUrl:"organizations/modals/add_person_opportunity.html",controller:"AddOpportunityPersonCtrl",windowClass:"add-opportunity-person",size:"sm",resolve:{opportunity:function(){return a.object},start_time:function(){return c}}});f.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}}]}}),angular.module("voluntrApp").directive("scheduleForm",function(){return{transclude:!0,templateUrl:"organizations/directives/schedule-form.html",scope:{recurringLabelText:"@",startDateText:"@",calendar:"="},restrict:"E",controller:["$scope",function(a){a.calendar.repeat.repeat_type={},a.calendar.repeat.monthly_repeat_type={},a.$watch("calendar.duration",function(){console.log(a.calendar.start_time),a.calendar.duration<36e5?a.duration_label="minutes":a.calendar.duration<72e5?a.duration_label="hour":a.duration_label="hours",a.calendar.end_time=a.calendar.start_time.getTime()+a.calendar.duration})}]}}),angular.module("voluntrApp").directive("editAddress",function(){return{transclude:!0,templateUrl:"organizations/directives/edit_address.html",scope:{address:"@",zipCode:"@",state:"@",city:"@",modelId:"@",addressType:"@"},restrict:"E",controller:["$scope","Opportunity","People","Organization",function(a,b,c,d){a.editing=!1,a.editAddress=function(){a.editing=!0},a.saveAddress=function(){var e={};e.id=a.modelId,e.address=a.address,e.city=a.city,e.zip_code=a.zipCode,e.state=a.state,"opportunity"===a.addressType?b.update(e):"person"==a.addressType?c.update(e):"organization"==a.addressType&&d.update(e),a.editing=!1}}]}}),angular.module("voluntrApp").directive("addResources",function(){return{transclude:!0,templateUrl:"organizations/directives/add_resources.html",scope:{resourceId:"@"},restrict:"E",controller:["$scope","Opportunity","$modal",function(a,b,c){a.openAddResourceModal=function(a){var b=c.open({templateUrl:"organizations/modals/add_resource.html",controller:"AddResourceCtrl",windowClass:"add-event-modal-window",size:a});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}]}}),angular.module("voluntrApp").directive("emailTemplatePreview",function(){return{transclude:!0,templateUrl:"organizations/directives/organization_email_template.html",scope:{resourceId:"@"},restrict:"E",controller:["$scope","Opportunity","$modal",function(a,b,c){a.openEmailPreview=function(a,b){var d=c.open({templateUrl:"organizations/modals/preview_organization_template_email.html",controller:"PreviewEmailTemplateCtrl",windowClass:"add-event-modal-window",size:a});d.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})}}]}}),angular.module("voluntrApp").directive("recordedHour",function(){return{transclude:!0,templateUrl:"organizations/directives/recorded_hour.html",scope:{recordedHour:"=",recordedHours:"=",type:"@"},restrict:"E",controller:["$scope","RecordedHours",function(a,b){a.editing=!1,a.saveRecordedHours=function(c){var d={};d.id=c.id,d.hours=c.hours,c.opportunity_role&&(d.opportunity_role_id=c.opportunity_role.id),b.update(d),a.editing=!1},a.deleteRecordedHour=function(c){b["delete"](c.id);var d=a.recordedHours.indexOf(c);d>-1&&a.recordedHours.splice(d,1)}}]}}),angular.module("voluntrApp").directive("editMailingServiceList",function(){return{transclude:!0,templateUrl:"organizations/directives/mailing_service_list.html",scope:{cabbage:"="},restrict:"E",controller:["$scope","OrganizationMailingService",function(a,b){a.organization_mailing_service=a.cabbage,a.editing=!1,a.update=function(c){a.editing=!1;var d={};d.id=c.organization_mailing_service_id,d.default_list_id=c.id,b.update(d)}}]}}),angular.module("voluntrApp").directive("reportLink",["$modal",function(a){function b(b,c,d){c.bind("click",function(){var b=a.open({templateUrl:"organizations/modals/generate_report.html",controller:"GenerateReportCtrl",windowClass:"add-event-modal-window",size:"sm",resolve:{rm_id:function(){return d.id},type:function(){return d.type}}});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})})}return{link:b}}]),angular.module("voluntrApp").directive("personSchedule",function(){return{transclude:!0,templateUrl:"organizations/directives/person_schedule.html",scope:{personId:"@"},restrict:"E",controller:["$scope","Opportunity","$modal",function(a,b,c){a.morning={},a.afternoon={},a.night={},a.updateWithSchedule=function(){var b={};b.id=a.personId,b.schedule={},
b.schedule.morning=a.morning,b.schedule.afternoon=a.afternoon,b.schedule.night=a.night,a.submitted=!0,People.update(b).$promise.then(function(b){a.person=b})}}]}}),angular.module("voluntrApp").directive("findPerson",function(){return{transclude:!0,templateUrl:"organizations/directives/find_person.html",scope:{person:"="},restrict:"E",controller:["$scope","$http","$stateParams",function(a,b,c){var d=function(b){var c=b._source,d={};d.id=c.person_id,d.first_name=c.person.first_name,d.last_name=c.person.last_name,d.score=b.score,-1==a.people.indexOf(d)&&(console.log("push"),a.people.push(d))};a.searching=!1,a.people_search=function(e){a.people=[],console.log(a.people),e&&!a.searching?(a.searching=!0,a.no_search=!1,b({url:"api/v1/organizations/"+c.organization_Id+"/people_search",params:{query:e}}).success(function(b,c,e,f){angular.forEach(b,d),a.searching=!1}).error(function(a,b,c,d){})):e||(a.searching=!1,a.no_search=!0)},a.selectPerson=function(b){a.person=b,a.volunteer_search=a.person.first_name+" "+a.person.last_name,a.no_search=!0}}]}}),angular.module("voluntrApp").directive("termsOfService",["$modal",function(a){function b(b,c,d){c.bind("click",function(){console.log(d);var b=a.open({templateUrl:"organizations/modals/terms_of_service.html",controller:"TOSCtrl",windowClass:"terms-of-service-modal",size:"md",resolve:{organization_id:function(){return d.organizationId}}});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})})}return{link:b}}]),angular.module("voluntrApp").filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]);