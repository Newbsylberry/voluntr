"use strict";angular.module("voluntrApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","facebook","ui.bootstrap","ui.router","duScroll","ngMaterial","ngMap","Devise","geolocation","highcharts-ng","kendo.directives"]).config(["FacebookProvider",function(a){a.init("1478625579067596")}]).config(["$httpProvider","AuthProvider",function(a,b){b.registerPath("/api/v1/users.json"),b.loginPath("/api/v1/users/sign_in.json"),a.interceptors.push("authInterceptor")}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("landing_page",{"abstract":!0,url:"/",templateUrl:"views/landing_page.html",controller:"LandingPageCtrl"}).state("landing_page.initial_page",{url:"",templateUrl:"views/landing_page_initial.html",controller:"LandingPageCtrl"}).state("volunteer_home",{url:"/volunteer_home",templateUrl:"views/volunteer_home.html",controller:"VolunteerHomeCtrl"}).state("landing_page.organization_landing",{url:"organizations",templateUrl:"views/landing_page_organizations.html",controller:"LandingPageOrganizationsCtrl"}).state("organization_home",{url:"/organization_home/:organization_Id",templateUrl:"views/organization_home.html",controller:"OrganizationHomeCtrl"}).state("profile",{url:"/profile/:profile_Id",templateUrl:"views/profile.html",controller:"ProfileCtrl"})}]),angular.module("voluntrApp").controller("LandingPageCtrl",["$scope","Facebook","Organization","$http","$state","Auth","$rootScope","$location","$window","$anchorScroll","$document","$modal",function(a,b,c,d,e,f,g,h,i,j,k,l){a.window_height=window.innerHeight,a.window_width=window.innerWidth,$(window).resize(function(){a.$apply(function(){a.window_height=i.innerHeight,a.window_width=i.innerWidth})});var m=1e3;a.goToSection=function(b){if(console.log(b),a.window_width>720)var c=225;else if(a.window_width<720&&"landing-page-organizations"!==b)var c=50;else if(a.window_width<720&&"landing-page-organizations"===b){console.log(b);var c=0}var d=angular.element(document.getElementById(b));k.scrollToElement(d,c,m)},a.organizationslide="organization-1",a.org1="active-link",a.organization_slide=function(b){a.org1="",a.org2="",a.org3="","organization-1"===b?a.org1="active-link":"organization-2"===b?a.org2="active-link":"organization-3"===b&&(a.org3="active-link"),a.organizationslide=b},a.contactslide="contact-1",a.contact_slide=function(b){console.log(b),a.contactslide=b},a.organizationLogIn=function(){b.getLoginStatus(function(c){"connected"===c.status?(a.facebook_token=c.authResponse.accessToken,e.go("landing_page.organization_landing")):"connected"!==c.status&&(b.login(function(){b.api("/me/accounts",function(b){a.facebook_token=b.authResponse.accessToken})},{scope:["manage_pages","user_groups"]}),e.go("landing_page.organization_landing"))}),console.log(a.organizations)},a.newContact=function(){d.post("/api/v1/user/contact_form",{email:a.newContact.contact_email,content:a.newContact.contact_content}).success(function(){alert("Thanks for Contacting Us, We Will Respond Soon!")}).error(function(){alert("Thanks for Contacting Us, We Will Respond Soon!"),a.newContact.contact_email="",a.newContact.contact_content=""})},a.open_lp_modal=function(b){var c=l.open({templateUrl:"views/tos_privacy.html",controller:"LandingPageCtrl",size:b});c.result.then(function(){a.profile.total_hours+=g.recordedHours,g.recordedHours=null},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").factory("Organization",["$resource",function(a){function b(){this.service=a("/api/v1/organizations/:organization_Id",{organization_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype.delete=function(a){return this.service.remove({Organization_Id:a})},new b}]),angular.module("voluntrApp").controller("LandingPageOrganizationsCtrl",["$scope","Facebook","$http","Organization",function(a,b,c,d){a.log_in=function(){b.login(function(){},{scope:"user_groups,read_insights,manage_pages"})};var e=function(b){if(!a.organizations){var d=[];a.organizations=d}c({method:"GET",url:"/api/v1/organizations/existence_check/"+b.id}).success(function(a){console.log(a),a?(b.exists=!0,b.v_id=a.id):a||(b.exists=!1)}).error(function(){}),a.organizations.push(b)};b.getLoginStatus(function(c){"connected"===c.status?(a.connected_to_facebook=!0,b.api("/me/accounts",function(a){angular.forEach(a.data,e)})):"connected"!==c.status&&(a.connected_to_facebook=!1)}),a.addOrganization=function(b){a.organization=b;var c={};c.fb_id=b.id,c.name=b.name,c.about=b.about,c.initial_likes=b.likes,c.initial_talking_about;var e=d.create(c);e.$promise.then(function(b){a.organization.v_id=b.id,a.organization.exists=!0})}}]),angular.module("voluntrApp").controller("OrganizationHomeCtrl",["$scope","Facebook","Organization","$stateParams","$state","Event","$http","$filter","$parse","$modal","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k){a.addOrganizationEvent=function(a){var b=j.open({templateUrl:"views/organization_add_event.html",controller:"AddEventCtrl",windowClass:"add-event-modal-window",size:a});b.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date)})};var l=function(b){b.likes?a.lineGraphConfig.series[0].data.push([b.created_time,b.likes.data.length]):b.likes||a.lineGraphConfig.series[0].data.push([b.created_time,0])};b.getLoginStatus(function(f){"connected"===f.status?c.get({organization_Id:d.organization_Id},function(c){b.api("/"+c.fb_id,function(d){b.api("/"+c.fb_id+"/posts",function(c){angular.forEach(c.data,function(c){var d={};d=c,d.liking_users=[],d.created_time=Date.parse(c.created_time),b.api("/"+d.id+"/likes",function(a){angular.forEach(a.data,function(b){d.liking_users.push(b),d.likes=a.data.length})}),a.organization.posts.push(d)}),a.organization.posts=h("orderBy")(a.organization.posts,"created_time"),angular.forEach(a.organization.posts,l)}),b.api("/"+c.fb_id+"/tagged",function(){}),a.organization=d,a.organization.posts=[],a.organization.events=c.events,b.api("/"+c.fb_id+"/photos",function(b){a.organization.picture=b.data[0],console.log(a.organization)})})}):"connected"!==f.status&&e.go("landing_page.initial_page")}),a.generated_stories="",a.open=function(b){var c=j.open({templateUrl:"views/add_additional_data.html",controller:"AddDataCtrl",size:b,resolve:{organization:function(){return a.organization}}});c.result.then(function(){},function(){console.log("Modal dismissed at: "+new Date),console.log(a.generated_stories)})},a.user_stories=!1,a.addEvent=function(b){var c={};c.fb_id=b.id,c.name=b.name,c.location=b.location,c.description=b.description,c.latitude=b.venue.latitude,c.longitude=b.venue.longitude,c.start_time=b.start_time,c.end_time=b.end_time,c.timezone=b.timezone,c.organization_id=d.organization_Id;f.create(c);a.event.exists,console.log(a.event)},a.addEventToGraph=function(b,c){if(console.log(c),b.graph_active)b.graph_active&&c>-1&&(k.lineGraphConfig.xAxis.plotLines.splice(b.plotLineIndex,1),k.lineGraphConfig.series[0].data.splice(b.event_data_point_index,1));else{console.log(b);var d={};d.color="red",d.dashStyle="longdashdot",d.value=Date.parse(b.start_time),d.width=3,d.label={},d.label.text=b.name,k.lineGraphConfig.xAxis.plotLines.push(d),b.plot_line_index=k.lineGraphConfig.xAxis.plotLines.indexOf(d);var e=[];e[0]=Date.parse(b.start_time)+6048e5,e[1]=null,k.lineGraphConfig.series[0].data.push(e),b.event_data_point_index=k.lineGraphConfig.series[0].data.indexOf(e),a.organization.posts[c]=b,console.log(b.event_data_point)}},k.lineGraphConfig={options:{chart:{type:"spline",zoomType:"xy"}},xAxis:{type:"datetime",plotLines:[]},yAxis:{allowDecimals:!1,floor:0},series:[{name:"Post Likes",data:[]}],title:{text:"Your Organization's Posts"},loading:!1,size:{height:"350"}},a.pieChartConfig={options:{chart:{type:"pie"}},series:[{name:"Attending Events",data:[["Under 18",10],["18-24",25],["24-34",30],["34-44",15],["44-60",10],["60+",10]]}],title:{text:"Demographic of Volunteers"},loading:!1,size:{height:"250"}},a.barChartConfig={options:{chart:{type:"bar"}},xAxis:{categories:["Event 1","Event 2","Event 3"]},series:[{name:"Attending Facebook Event",data:[200,250,300]},{name:"Recorded Hours",data:[45,80,120]},{name:"Fund Raising",data:[450,600,1e3]}],title:{text:"Past Events Information"},loading:!1,size:{height:"250"}}}]),angular.module("voluntrApp").factory("Event",["$resource",function(a){function b(){this.service=a("/api/v1/events/:event_Id",{Event_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype.delete=function(a){return this.service.remove({event_Id:a})},new b}]),angular.module("voluntrApp").service("authInterceptor",["$rootScope","$q","$location","$injector",function(a,b){return{request:function(a){return a.headers=a.headers||{},localStorage.token?a.headers.Authorization="Bearer "+localStorage.token:sessionStorage.token&&(a.headers.Authorization="Bearer "+sessionStorage.token),a},response:function(a){return a||b.when(a)}}}]),angular.module("voluntrApp").controller("VolunteerHomeCtrl",["$scope","geolocation","Event","Organization","$http","$timeout","$modal","$rootScope","User",function(a,b,c,d,e,f){a.loaded=!1,console.log(a.loaded),f(function(){a.loaded=!0},3e3),b.getLocation().then(function(b){a.coords={lat:b.coords.latitude,"long":b.coords.longitude}}),a.getDistance=function(b){var c=new google.maps.LatLng(a.coords.lat,a.coords.long);!b.distance&&b.latitude&&b.longitude&&f(function(){function d(c,d){d==google.maps.DistanceMatrixStatus.OK?(console.log(c.rows[0].elements[0]),b.distance=c.rows[0].elements[0].distance.text,a.event=b):d!==google.maps.DistanceMatrixStatus.OK&&console.log(d)}var e=c,f=new google.maps.LatLng(b.latitude,b.longitude),g=new google.maps.DistanceMatrixService;g.getDistanceMatrix({origins:[e],destinations:[f],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.IMPERIAL},d)},700)},a.events=c.all(),console.log(a.events),a.$on("mapInitialized",function(){})}]),angular.module("voluntrApp").controller("LandingPageVolunteerCtrl",["$scope","$state","Auth","$rootScope",function(a,b,c,d){localStorage.user_id&&b.go("volunteer_home"),a.newVolunteer=function(){var e={};e.email=a.newVolunteer.email,e.password=a.newVolunteer.password,e.passwordConfirmation=a.newVolunteer.passwordConfirmation,c.register(e).then(function(a){console.log(a),d.user=a.user,localStorage.token=a.token,localStorage.user_id=a.user.id,b.go("volunteer_home",{user_Id:a.user.id})})},a.logIn=function(){var e={};e.email=a.logIn.email,e.password=a.logIn.password,c.login(e).then(function(a){d.user=a.user,localStorage.user_id=a.user.id,localStorage.token=a.token,b.go("volunteer_home",{user_Id:a.user.id})})}}]),angular.module("voluntrApp").controller("ProfileCtrl",["$scope","$log","$modal","Profile","$stateParams","$rootScope",function(a,b,c,d,e,f){d.get({profile_Id:e.profile_Id},function(b){a.profile=b},function(){}),a.open=function(b){var d=c.open({templateUrl:"views/record_hours.html",controller:"RecordHoursCtrl",windowClass:"record-hours-modal-window",size:b});d.result.then(function(){a.profile.total_hours+=f.recordedHours,f.recordedHours=null},function(){console.log("Modal dismissed at: "+new Date)})}}]),angular.module("voluntrApp").controller("RecordHoursCtrl",["$scope","Event","UserEventHours","$modal","$modalInstance","$rootScope",function(a,b,c,d,e,f){a.events=b.all(),a.hours1=0,a.hours2=0,a.h1_up=function(){a.hours1<9&&(a.hours1+=1)},a.h2_up=function(){a.hours2<9&&(a.hours2+=1)},a.h1_down=function(){a.hours1>0&&(a.hours1-=1)},a.h2_down=function(){a.hours2>0&&(a.hours2-=1)},a.recordHours=function(){var b=10*a.hours1+a.hours2,d={};d.event_id=a.recordHours.event_id,d.user_id=localStorage.user_id,d.description=a.description,d.hours=b;var g=c.create(d);f.recordedHours=g.hours,e.close()}}]),angular.module("voluntrApp").factory("UserEventHours",["$resource",function(a){function b(){this.service=a("/api/v1/user_event_hours/:user_event_hours_Id",{organization_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype.delete=function(a){return this.service.remove({user_event_hours_Id:a})},new b}]),angular.module("voluntrApp").factory("Profile",["$resource",function(a){function b(){this.service=a("/api/v1/profiles/:profile_Id",{organization_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.all=function(){return this.service.query()},b.prototype.get=function(a,b,c){return this.service.get(a,b,c)},b.prototype.create=function(a){return this.service.save(a)},b.prototype.update=function(a){return this.service.update(a)},b.prototype.delete=function(a){return this.service.remove({profile_Id:a})},new b}]),angular.module("voluntrApp").factory("User",["$resource",function(a){function b(){this.service=a("/api/v1/users/:user_Id",{user_Id:"@id"},{update:{method:"PATCH"}})}return b.prototype.get=function(a,b,c){this.service.get(a,b,c)},b.prototype.update=function(a){return this.service.update(a)},new b}]),angular.module("voluntrApp").controller("ProfileCreateCtrl",["$scope","Profile","$modalInstance",function(a,b,c){a.createProfile=function(){console.log("modal");var d={};d.user_id=a.user.id,d.first_name=a.createProfile.first_name,d.last_name=a.createProfile.last_name;var e=b.create(d);a.user.profile=e,c.close()}}]),angular.module("voluntrApp").controller("AddDataCtrl",["$scope","organization","Facebook","$filter",function(a,b,c){a.organization=b,a.toggleImpressionDataOnLineGraph=function(b,d,e){var f={name:e,data:[]},g=[];angular.forEach(b,function(a){var b=[];if("shared_post"!==d)var c={method:"GET",relative_url:"/"+a.id+"/insights/"+d+"/lifetime"};else if("shared_post"===d)var c={method:"GET",relative_url:"/"+a.id+"/sharedposts/"};b[0]=a.created_time,g.push(c),f.data.push(b)}),c.api("/","POST",{batch:g,include_headers:!1},function(a){for(var b=a.length-1;b>=0;b--){var c=a[b],e=JSON.parse(c.body);"shared_post"!==d?f.data[b][1]=e.data[0].values[0].value:"shared_post"===d&&(f.data[b][1]=e.data.length)}}),a.lineGraphConfig.series.push(f),console.log(f.data),console.log(a.lineGraphConfig.series)}}]),angular.module("voluntrApp").controller("AddEventCtrl",["$scope","$timeout","Event","$stateParams","$modalStack","$rootScope","$state","Organization","Facebook","$http",function(a,b,c,d,e,f,g,h,i,j){var k=function(b){if(!a.events){var c=[];a.facebook_events=c}i.api("/"+b.id,function(c){b=c,j({method:"GET",url:"/api/v1/events/existence_check/"+b.id}).success(function(c){c||a.facebook_events.push(b)}).error(function(){})})};h.get({organization_Id:d.organization_Id},function(a){i.api("/"+a.fb_id+"/events",function(a){angular.forEach(a.data,k)})}),a.addEvent=function(f,h){var i={};if("manual_event"===h)i.name=a.addEvent.event_name,i.description=a.addEvent.description,i.start_time=new Date(a.addEvent.start_time),i.end_time=new Date(a.addEvent.end_time),i.organization_id=d.organization_Id,b(function(){var f=new google.maps.Geocoder;f.geocode({address:a.addEvent.address},function(b,c){c==google.maps.GeocoderStatus.OK&&angular.forEach(b,function(b){angular.forEach(b.address_components,function(c){if(c.short_name===a.addEvent.zip_code){var d=new google.maps.LatLng(b.geometry.location.D,b.geometry.location.k);console.log(d),i.latitude=b.geometry.location.k,i.longitude=b.geometry.location.D}})})}),b(function(){c.create(i);e.dismissAll(),g.transitionTo(g.current,d,{reload:!0,inherit:!1,notify:!0})},3e3)},3e3);else if("facebook_event"===h){i.fb_id=f.id,i.name=f.name,i.location=f.location,i.description=f.description,i.latitude=f.venue.latitude,i.longitude=f.venue.longitude,i.start_time=f.start_time,i.end_time=f.end_time,i.timezone=f.timezone,i.organization_id=d.organization_Id;var j=c.create(i);j.exists=!0,a.event=j,g.transitionTo(g.current,d,{reload:!0,inherit:!1,notify:!0}),e.dismissAll()}},a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a[c]=!0}}]);